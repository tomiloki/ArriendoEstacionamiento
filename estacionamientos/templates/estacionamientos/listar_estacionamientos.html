<!-- templates/estacionamientos/listar_estacionamientos.html -->

{% extends 'base.html' %}

{% block content %}
<h2>Estacionamientos por tu zona</h2>

<!-- Aquí tu lista textual, si quieres -->
<ul>
  {% for e in estacionamientos %}
    <li>
      {{ e.ubicacion }} (coords: {{ e.coordenadas }})
      {% if e.disponibilidad %}(Disponible){% endif %}
    </li>
  {% endfor %}
</ul>

<!-- Contenedor del mapa -->
<div id="map" style="height: 400px;"></div>

<script>
  function initMap() {
    const center = { lat: -33.4489, lng: -70.6693 };
    const map = new google.maps.Map(document.getElementById("map"), {
      zoom: 11,
      center: center
    });

    // Bucle de Django en el template (cuando se renderiza, se expandirá)
    {% for e in estacionamientos %}
      const coords = "{{ e.coordenadas }}".split(",");
      const lat = parseFloat(coords[0]);
      const lng = parseFloat(coords[1]);
      new google.maps.Marker({
        position: {lat: lat, lng: lng},
        map: map,
        title: "{{ e.ubicacion }}"
      });
    {% endfor %}
  }
</script>

<script
  src="https://maps.googleapis.com/maps/api/js?key={{GOOGLE_MAPS_API_KEY}}&callback=initMap"
  loading="async"
  defer
></script>
{% endblock %}