{% extends 'base.html' %}
{% block content %}
<div class="container mt-4">
    <h2 class="text-center fw-bold text-success">Detalle del Estacionamiento</h2>

    <div class="card mt-3 shadow">
        <div class="card-body">
            <h4 class="card-title text-center text-dark">{{ estacionamiento.ubicacion }}</h4>
            <p class="text-center text-muted">Tipo: {{ estacionamiento.tipo }}</p>
            
            <!-- Mapa -->
            <div id="map" style="width: 100%; height: 400px;" class="mt-3"></div>

            <!-- InformaciÃ³n -->
            <ul class="list-group list-group-flush mt-3">
                <li class="list-group-item">ðŸ’° Tarifa: <strong>${{ estacionamiento.tarifa }} USD/hora</strong></li>
                <li class="list-group-item">ðŸš¦ Estado: 
                    {% if estacionamiento.disponibilidad %}
                        <span class="badge bg-success">Disponible</span>
                    {% else %}
                        <span class="badge bg-danger">No Disponible</span>
                    {% endif %}
                </li>
                <li class="list-group-item">ðŸ”‘ Acceso Remoto: 
                    {% if estacionamiento.accesoRemoto %}
                        <span class="badge bg-primary">SÃ­</span>
                    {% else %}
                        <span class="badge bg-secondary">No</span>
                    {% endif %}
                </li>
            </ul>

            <!-- Reservar -->
            {% if estacionamiento.disponibilidad %}
                <div class="text-center mt-4">
                    <a href="{% url 'crear_reserva' estacionamiento.id %}" class="btn btn-lg btn-success">
                        ðŸ“… Reservar este Estacionamiento
                    </a>
                </div>
            {% else %}
                <p class="text-center text-danger mt-3 fw-bold">Este estacionamiento no estÃ¡ disponible.</p>
            {% endif %}
        </div>
    </div>

    <!-- SecciÃ³n de Reservas -->
    <div class="mt-5">
        <h4 class="text-center text-dark">ðŸ“… Reservas Actuales</h4>
        {% if reservas %}
            <ul class="list-group mt-3">
                {% for reserva in reservas %}
                    <li class="list-group-item">
                        ðŸ•’ Desde: {{ reserva.fechaInicio }} â†’ Hasta: {{ reserva.fechaFin }}
                        <span class="badge bg-warning">{{ reserva.estado }}</span>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p class="text-center text-muted">No hay reservas en este estacionamiento.</p>
        {% endif %}
    </div>
</div>

<!-- Script de Google Maps -->
<script>
    function initMap() {
        var estacionamiento = {
            lat: parseFloat("{{ lat|default:-33.4489 }}"),  // Santiago por defecto
            lng: parseFloat("{{ lng|default:-70.6693 }}")
        };

        var map = new google.maps.Map(document.getElementById('map'), {
            center: estacionamiento,
            zoom: 15
        });

        var marker = new google.maps.Marker({
            position: estacionamiento,
            map: map,
            title: "{{ estacionamiento.ubicacion }}"
        });
    }
</script>


<script src="https://maps.googleapis.com/maps/api/js?key={{ google_maps_key }}&callback=initMap" async defer></script>
{% endblock %}
